name: Debug Terraform

on: [workflow_dispatch]

permissions:
  contents: read

jobs:
  debug:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: Infra/terraform

    env:
      ARM_CLIENT_ID: ${{ secrets.ARM_CLIENT_ID }}
      ARM_CLIENT_SECRET: ${{ secrets.ARM_CLIENT_SECRET }}
      ARM_SUBSCRIPTION_ID: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      ARM_TENANT_ID: ${{ secrets.ARM_TENANT_ID }}

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Display Configuration
      run: |
        echo "=== Your Configuration Files ==="
        echo "1. backend.tf:"
        cat backend.tf
        echo ""
        echo "2. providers.tf:"
        cat providers.tf
        echo ""
        echo "3. Environment Variables:"
        echo "   ARM_CLIENT_ID: ${ARM_CLIENT_ID:0:10}..."
        echo "   ARM_CLIENT_SECRET: ${ARM_CLIENT_SECRET:0:10}..."
        echo "   ARM_TENANT_ID: ${ARM_TENANT_ID}"
        echo "   ARM_SUBSCRIPTION_ID: ${ARM_SUBSCRIPTION_ID}"

    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v3

    - name: Test Terraform Init
      run: |
        echo "=== Testing terraform init ==="
        rm -rf .terraform .terraform.lock.hcl 2>/dev/null || true
        terraform init -input=false
